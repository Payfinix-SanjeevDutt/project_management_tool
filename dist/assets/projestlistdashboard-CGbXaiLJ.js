import{r as n,a7 as E,a8 as R,j as e,aR as Z,bI as $,B as d,k as T,ae as I,ag as B,aa as N,a9 as H,E as L,ac as M,J as b,K as r,ad as V,F as q,S as G,A as ee,H as te,Q as se,W as F,f as re,ab as ae,Z as ne,I as W,af as oe}from"./index-BXVaN-Bg.js";import{C as le}from"./CircularProgress-DeAomXPU.js";const ie=({open:x,handleClose:f,assigneeId:c,overrunType:o})=>{const[u,g]=n.useState([]),[j,C]=n.useState(!1),[y,k]=n.useState(""),[w,_]=n.useState(""),[m,S]=n.useState("asc"),D=s=>{if(!s)return"#9E9E9E";const l=s.charAt(0).toUpperCase().charCodeAt(0),i=["#FF5733","#33FF57","#3357FF","#F39C12","#9B59B6","#E74C3C","#1ABC9C","#D35400","#27AE60","#8E44AD"];return i[l%i.length]};n.useEffect(()=>{if(x&&c&&o){C(!0),k(""),g([]);let s;o==="completed_overrun"?s=E.post(R.project.project_completed_overrun,{project_id:c}):o==="inprogress_overrun"?s=E.post(R.project.project_inprogress_overrun,{project_id:c}):s=E.post(R.project.project_todo_overrun,{project_id:c}),s&&s.then(l=>{var i;console.log(l.data.data),(i=l.data)!=null&&i.status?(g(l.data.data),_(l.data.project_name||"Unknown Project")):k("No tasks found.")}).catch(()=>{k("Error fetching data.")}).finally(()=>C(!1))}},[x,c,o]);const v=()=>{const s=[...u].sort((l,i)=>m==="asc"?l.employee_name.localeCompare(i.employee_name):i.employee_name.localeCompare(l.employee_name));g(s),S(m==="asc"?"desc":"asc")};return e.jsx(Z,{open:x,onClose:f,closeAfterTransition:!0,BackdropComponent:$,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.6)"}},children:e.jsx(d,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:"100%",sm:"85%",md:"90%"},maxHeight:"90vh",overflowY:"auto",bgcolor:"background.paper",p:{xs:2,sm:4},borderRadius:2},children:y?e.jsx(T,{variant:"body2",color:"error",textAlign:"center",children:e.jsx(I,{title:"no data"})}):e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"subtitle1",fontWeight:"bold",sx:{mb:2,textAlign:"left",fontSize:{xs:"1rem",sm:"1.2rem"}},children:j?e.jsx(B,{width:200}):`${w} :`}),e.jsx(N,{component:H,sx:{maxHeight:{xs:300,sm:400},width:"100%",overflowX:"auto",p:{xs:1,sm:2},mt:2,borderRadius:2,boxShadow:3,borderRight:"1px solid rgba(224, 224, 224, 1)"},children:e.jsxs(L,{stickyHeader:!0,children:[e.jsx(M,{children:e.jsxs(b,{children:[e.jsx(r,{align:"center",children:e.jsx(V,{active:!0,direction:m,onClick:v,children:e.jsx("b",{children:"Employee Name"})})}),e.jsx(r,{align:"center",children:e.jsx("b",{children:"Stage Name"})}),e.jsx(r,{children:e.jsx("b",{children:"Task Name"})}),e.jsx(r,{align:"center",children:e.jsx("b",{children:"Status"})}),e.jsx(r,{align:"center",children:e.jsx("b",{children:"Start Date"})}),e.jsx(r,{align:"center",children:e.jsx("b",{children:"End Date"})}),o!=="delayed_tasks"&&e.jsx(r,{align:"center",children:e.jsx("b",{children:"Actual start date"})}),o!=="inprogress_overrun"&&o!=="delayed_tasks"&&e.jsx(r,{align:"center",children:e.jsx("b",{children:"Actual end date"})}),e.jsx(r,{align:"center",children:e.jsx("b",{children:"Extra days"})})]})}),e.jsx(q,{children:j?[...Array(5)].map((s,l)=>e.jsx(b,{children:[...Array(o!=="inprogress_overrun"?6:5)].map(i=>e.jsx(r,{children:e.jsx(B,{})},i))},l)):u.map(s=>e.jsxs(b,{children:[e.jsx(r,{children:e.jsxs(G,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(ee,{sx:{px:2,py:.5,bgcolor:D(s.employee_name),width:32,height:32,fontSize:16},children:s.employee_name?s.employee_name.charAt(0).toUpperCase():"?"}),s.employee_name]})}),e.jsx(r,{align:"center",children:s.stage_name}),e.jsx(r,{children:s.task_name}),e.jsx(r,{align:"center",children:s.status}),e.jsx(r,{align:"center",children:s.start_date}),e.jsx(r,{align:"center",children:s.end_date}),o!=="delayed_tasks"&&e.jsx(r,{align:"center",children:s.actual_start_date}),o!=="inprogress_overrun"&&o!=="delayed_tasks"&&e.jsx(r,{align:"center",sx:{color:"error.main",fontWeight:"bold"},children:s.actual_end_date}),e.jsx(r,{align:"center",sx:{color:"error.main",fontWeight:"bold"},children:s.extra_days})]},s.task_id))})]})}),e.jsx(d,{sx:{display:"flex",justifyContent:"flex-end",mt:3},children:e.jsx(te,{onClick:f,variant:"contained",children:"Close"})})]})})})};function ce(){const[x,f]=n.useState("asc"),[c,o]=n.useState("name"),[u,g]=n.useState(0),[j,C]=n.useState(25),[y,k]=n.useState([]),[w,_]=n.useState(!1),[m,S]=n.useState(null),[D,v]=n.useState(!1),[s,l]=n.useState(""),[i,U]=n.useState(null),P=se(),O=[{key:"project_name",label:"Projects",icon:"solar:user-outline",sortable:!0},{key:"total_stages",label:"Total Stages",icon:"bi:list-task",sortable:!0},{key:"total_tasks",label:"Total Tasks",icon:"bi:list-task",sortable:!0},{key:"completed_tasks",label:"Completed Tasks",icon:"hugeicons:task-done-02",sortable:!0},{key:"inprogress_tasks",label:"In-Progress Tasks",icon:"qlementine-icons:task-soon-16",sortable:!0},{key:"delayed_tasks",label:"Delayed Tasks",icon:"qlementine-icons:task-past-16",sortable:!0},{key:"completed_overrun",label:"Completed Overrun",icon:"fluent-mdl2:recurring-task",sortable:!0},{key:"inprogress_overrun",label:"In-Progress Overrun",icon:"carbon:task-asset-view",sortable:!0},{key:"number_employees",label:"Total Employees",icon:"bi:list-task",sortable:!0}];n.useEffect(()=>{_(!0),S(null),E.get(R.project.project_stage_report).then(t=>{k(t.data),_(!1)}).catch(t=>{S(t.message||"Failed to fetch data"),_(!1)})},[]);const z=t=>{f(c===t&&x==="asc"?"desc":"asc"),o(t)},A=Array.isArray(y.projects)&&y.projects.length>0?[...y.projects].sort((t,h)=>{const a=t[c]??"",p=h[c]??"";return typeof a=="string"?x==="asc"?a.localeCompare(p):p.localeCompare(a):x==="asc"?(a||0)-(p||0):(p||0)-(a||0)}):[],X=(t,h)=>g(h),J=t=>{C(parseInt(t.target.value,10)),g(0)},K=(t,h)=>{U(t),l(h),v(!0)},Q=n.useCallback(t=>{P.push(F.dashboard.projectdashboard.homestages(t))},[P]),Y=n.useCallback(t=>{P.push(F.dashboard.projectdashboard.homeusers(t))},[P]);return e.jsxs(re,{component:H,sx:{borderRadius:2,overflowX:"auto",margin:{xs:1,sm:2,md:4}},children:[e.jsxs(N,{children:[e.jsx(ae,{sx:{display:"flex",justifyContent:"space-between",padding:{xs:1,sm:2}},children:e.jsx(T,{variant:"subtitle1",children:"Project Dashboard"})}),w?e.jsx(d,{display:"flex",justifyContent:"center",alignItems:"center",sx:{py:5},children:e.jsx(le,{})}):m?e.jsx(d,{sx:{py:2,px:3},children:e.jsx(ne,{severity:"error",children:m})}):e.jsxs(L,{children:[e.jsx(M,{children:e.jsx(b,{children:O.map(t=>e.jsx(r,{sx:{minWidth:160,textAlign:"center"},children:t.sortable?e.jsxs(V,{active:c===t.key,direction:c===t.key?x:"asc",onClick:()=>z(t.key),children:[e.jsx(W,{icon:t.icon,width:20,sx:{color:"grey.500"}}),t.label]}):e.jsxs("span",{children:[e.jsx(W,{icon:t.icon,width:20,sx:{color:"grey.500"}}),t.label]})},t.key))})}),e.jsx(q,{children:A.length===0?e.jsx(b,{children:e.jsx(r,{colSpan:O.length,align:"center",children:e.jsx(I,{title:"No project data found.",sx:{py:10}})})}):A.slice(u*j,u*j+j).map((t,h)=>e.jsx(b,{sx:{height:"20px"},children:O.map(a=>e.jsx(r,{sx:{minWidth:120,textAlign:a.key==="project_name"?"left":"center",verticalAlign:"middle",padding:"4px 8px"},children:a.key.includes("completed_overrun")||a.key.includes("delayed_tasks")||a.key.includes("inprogress_overrun")?t[a.key]!==0?e.jsx(d,{sx:{display:"inline-block",px:1.5,py:.5,borderRadius:1,fontWeight:"bold",color:"error.main",cursor:"pointer",textDecoration:"underline","&:hover":{color:"error.dark"}},onClick:()=>K(t.project_id,a.key),children:t[a.key]}):e.jsx(d,{sx:{display:"inline-block",px:1.5,py:.5,borderRadius:1,fontWeight:"bold",color:p=>p.palette.text.primary},children:t[a.key]}):a.key.includes("project_name")?e.jsx(d,{sx:{px:2,py:.5,cursor:"pointer",textDecoration:"underline",color:"black","&:hover":{color:"green"}},onClick:()=>Q(t.project_id),children:t[a.key]}):a.key.includes("number_employees")?e.jsx(d,{sx:{px:2,py:.5,cursor:"pointer",textDecoration:"underline",color:"black","&:hover":{color:"green"}},onClick:()=>Y(t.project_id),children:t[a.key]}):e.jsx(d,{sx:{display:"inline-block",px:1.5,py:.5,borderRadius:1,fontWeight:"bold",color:p=>t[a.key]===0?"inherit":p.palette.text.primary},children:t[a.key]})},a.key))},h))})]})]}),e.jsx(ie,{open:D,handleClose:()=>v(!1),assigneeId:i,overrunType:s}),A.length>0&&e.jsx(oe,{rowsPerPageOptions:[5,10,25],component:"div",count:A.length,rowsPerPage:j,page:u,onPageChange:X,onRowsPerPageChange:J})]})}function he(){return e.jsx(ce,{})}export{he as default};
