import{ah as o,r as I,ai as _,_ as y,aj as N,l as A,ak as T,j as e,f as k,G as F,S,al as l,a7 as C,a8 as b,am as W,an as i,W as D,ao as U,ap as G,N as B,P as L}from"./index-BXVaN-Bg.js";import{C as z}from"./custom-breadcrumbs-DVNouI9r.js";import{C as H}from"./CardHeader-CynLBTsA.js";import{C as K}from"./CardContent-DM5qRC3a.js";import{D as p}from"./DatePicker-01LY8aSd.js";import{L as R}from"./LoadingButton-L3kQ20Ll.js";import"./Breadcrumbs-DjhM_bul.js";import"./createStyled-mUU3E4G-.js";import"./DialogContent-CxPgUekA.js";import"./CircularProgress-DeAomXPU.js";const q={stageName:"",description:"",startDate:o(),endDate:o(),actualStartDate:null,actualEndDate:null,stageId:null};function J(){const[a,h]=I.useState(q),{currentProjectId:c}=_(t=>t.projects),u=y(),f=N(),j=A(),{projectId:Q,id:d}=T(),M=_(t=>t.stages.stages),s=d?M.find(t=>t.id===d):null;I.useEffect(()=>{d&&s&&h({stageId:s.id,project_id:s.project_id,stageName:s.stage_name,description:s.description,startDate:s.startDate?o(s.startDate):null,endDate:s.endDate?o(s.endDate):o(),actualStartDate:s.actualStartDate?o(s.actualStartDate):null,actualEndDate:s.actualEndDate?o(s.actualEndDate):null})},[d,s]);const Y=t=>{const{name:n,value:r}=t.target;h(m=>({...m,[n]:r}))},g=(t,n)=>{h(r=>({...r,[t]:n}))},E=async()=>{u.onTrue();const t={stage_name:a.stageName,description:a.description,project_id:c,start_date:a.startDate.format("YYYY-MM-DD"),end_date:a.endDate.format("YYYY-MM-DD"),actual_start_date:a.actualStartDate?a.actualStartDate.format("YYYY-MM-DD"):null,actual_end_date:a.actualEndDate?a.actualEndDate.format("YYYY-MM-DD"):null};try{const n=await C.post(b.stages.create,t),{message:r,error:m,data:x}=n.data;m===0?(f(W({stage_name:x.stage_name,id:x.stage_id})),i.success("Stage created successfully!"),j(D.dashboard.stages.task(c,x.stage_id))):i.error(r)}catch(n){console.error(n),i.error("Unable to create stage")}finally{u.onFalse()}},w=async()=>{u.onTrue();const t={stage_id:a.stageId,name:a.stageName,description:a.description,project_id:c,start_date:a.startDate.format("YYYY-MM-DD"),end_date:a.endDate.format("YYYY-MM-DD"),actual_start_date:a.actualStartDate?a.actualStartDate.format("YYYY-MM-DD"):null,actual_end_date:a.actualEndDate?a.actualEndDate.format("YYYY-MM-DD"):null};try{const n=await C.put(b.stages.update,t),{message:r,error:m}=n.data;m===0?(f(U({id:a.stageId,stage_name:a.stageName})),f(G(c)),i.success("Stage updated successfully!"),j(D.dashboard.stages.task(c,a.stageId))):i.error(r)}catch(n){console.error(n),i.error("Unable to process")}finally{u.onFalse()}},P=async()=>{a.stageId?await w():await E()};return e.jsxs(k,{sx:{mx:"auto",width:"80%"},children:[e.jsx(H,{title:d?"Edit Stage":"Create Stage",subheader:"Title, short description, dates ...",sx:{mb:3}}),e.jsx(F,{}),e.jsx(K,{children:e.jsxs(S,{gap:4,children:[e.jsx(l,{fullWidth:!0,name:"stageName",label:"Stage Name",variant:"outlined",value:a.stageName,onChange:Y}),e.jsx(l,{fullWidth:!0,multiline:!0,rows:5,label:"Description",variant:"outlined",name:"description",value:a.description,onChange:Y}),e.jsxs(S,{direction:"row",gap:2,children:[e.jsx(p,{label:"Start Date",name:"startDate",value:a.startDate,onChange:t=>g("startDate",t),renderInput:t=>{var n;return e.jsx(l,{...t,fullWidth:!0,variant:"outlined",InputProps:{...t.InputProps,endAdornment:(n=t.InputProps)==null?void 0:n.endAdornment}})},sx:{flexGrow:1}}),e.jsx(p,{label:"End Date",name:"endDate",value:a.endDate,onChange:t=>g("endDate",t),renderInput:t=>{var n;return e.jsx(l,{...t,fullWidth:!0,variant:"outlined",InputProps:{...t.InputProps,endAdornment:(n=t.InputProps)==null?void 0:n.endAdornment}})},sx:{flexGrow:1}})]}),e.jsxs(S,{direction:"row",gap:2,children:[e.jsx(p,{label:"Actual Start Date",name:"actualstartdate",value:a.actualStartDate,onChange:t=>g("actualStartDate",t),renderInput:t=>{var n;return e.jsx(l,{...t,fullWidth:!0,variant:"outlined",InputProps:{...t.InputProps,endAdornment:(n=t.InputProps)==null?void 0:n.endAdornment}})},sx:{flexGrow:1}}),e.jsx(p,{label:"Actual End Date",name:"actualenddate",value:a.actualEndDate,onChange:t=>g("actualEndDate",t),renderInput:t=>{var n;return e.jsx(l,{...t,fullWidth:!0,variant:"outlined",InputProps:{...t.InputProps,endAdornment:(n=t.InputProps)==null?void 0:n.endAdornment}})},sx:{flexGrow:1}})]}),e.jsx(R,{variant:"contained",onClick:P,size:"medium",sx:{alignSelf:"flex-end"},loading:u.value,children:d?"Update Stage":"Save Stage"})]})})]})}function O(){return e.jsxs(B,{children:[e.jsx(z,{heading:"Create a new Stage",links:[{name:"Dashboard",href:D.dashboard.root},{name:"Stages",href:D.dashboard.stages.create},{name:"New Stage"}],sx:{mb:{xs:3,md:5}}}),e.jsx(J,{})]})}const v={title:"PMS-Create Stage",description:"The starting point for your next project with Minimal UI Kit, built on the newest version of Material-UI Â©, ready to be customized to your style"};function ot(){return e.jsxs(e.Fragment,{children:[e.jsxs(L,{children:[e.jsx("title",{children:v.title}),e.jsx("meta",{name:"description",content:v.description})]}),e.jsx(O,{})]})}export{ot as default};
