import{aq as Rt,r as m,ar as Qe,as as J,at as Ke,au as ut,av as ht,s as Te,a9 as Ge,aw as It,ax as xt,ay as $e,j as e,az as At,aA as pt,aB as De,u as Ot,aC as Pt,aD as Lt,ak as Ve,aj as fe,l as Mt,a as Ee,f as me,B as k,S as E,ag as Q,G as Ce,k as f,a2 as se,I as T,aE as X,C as Re,M as Ie,c as $,aF as mt,H as Z,a7 as L,a8 as M,aG as Ft,W as ke,aH as gt,v as Nt,T as Be,L as q,ai as le,a6 as ft,aI as Wt,aJ as Le,aK as Ht,aL as zt,aM as Ut,aN as $t,aO as Bt,aP as Yt,aQ as Gt,_ as re,aR as qe,al as Y,an as W,ac as jt,J as ce,K as I,ad as Vt,aS as Me,aT as Je,Z as qt,ah as H,aU as bt,aV as et,ae as ge,aW as Jt,aX as Xt,A as Ye,aY as Fe,a1 as _t,aa as vt,E as yt,F as wt,i as tt,aZ as Zt,a_ as Qt,a$ as Kt,N as ea,x as ta,P as aa}from"./index-BXVaN-Bg.js";import{C as na}from"./custom-breadcrumbs-DVNouI9r.js";import{u as sa,e as ra,T as oa}from"./table-pagination-custom-DELtcPLa.js";import{T as ia}from"./table-empty-rows-DU8s3bMi.js";import{D as Ct}from"./DialogTitle-BTq9gtTJ.js";import{D as St,a as Dt,C as Ne}from"./DialogContent-CxPgUekA.js";import{D as la,L as at}from"./DialogContentText-DR71QP_C.js";import{B as kt}from"./Breadcrumbs-DjhM_bul.js";import{L as Xe}from"./LoadingButton-L3kQ20Ll.js";import{C as Ze}from"./Checkbox-DIz0V3dn.js";import{v as ca,D as he,L as We}from"./DatePicker-01LY8aSd.js";import{C as da}from"./ClickAwayListener-_j_WpWlF.js";import{A as nt}from"./Autocomplete-DxNy6pfN.js";import{C as ua}from"./confirm-dialog-DwBTbcqe.js";import{u as ha,a as xa,F as pa}from"./fields-CtJmr7vf.js";import"./image-DGI4zpN2.js";import{G as Se}from"./Grid2-BjjkDMBF.js";import{F as ma,a as He,c as ze}from"./filters-result-DCGeM_5H.js";import"./FormControlLabel-BRFnA9-2.js";import"./CircularProgress-DeAomXPU.js";import"./createStyled-mUU3E4G-.js";import"./date-time-utils-CU9-YODR.js";import"./utils-crRmHoXN.js";import"./format-number-DrEElRjc.js";function ga(t={}){const{autoHideDuration:n=null,disableWindowBlurListener:r=!1,onClose:s,open:i,resumeHideDuration:x}=t,j=Rt();m.useEffect(()=>{if(!i)return;function h(p){p.defaultPrevented||(p.key==="Escape"||p.key==="Esc")&&(s==null||s(p,"escapeKeyDown"))}return document.addEventListener("keydown",h),()=>{document.removeEventListener("keydown",h)}},[i,s]);const l=Qe((h,p)=>{s==null||s(h,p)}),a=Qe(h=>{!s||h==null||j.start(h,()=>{l(null,"timeout")})});m.useEffect(()=>(i&&a(n),j.clear),[i,n,a,j]);const b=h=>{s==null||s(h,"clickaway")},_=j.clear,w=m.useCallback(()=>{n!=null&&a(x??n*.5)},[n,x,a]),d=h=>p=>{const g=h.onBlur;g==null||g(p),w()},o=h=>p=>{const g=h.onFocus;g==null||g(p),_()},u=h=>p=>{const g=h.onMouseEnter;g==null||g(p),_()},c=h=>p=>{const g=h.onMouseLeave;g==null||g(p),w()};return m.useEffect(()=>{if(!r&&i)return window.addEventListener("focus",w),window.addEventListener("blur",_),()=>{window.removeEventListener("focus",w),window.removeEventListener("blur",_)}},[r,i,w,_]),{getRootProps:(h={})=>{const p=J({},Ke(t),Ke(h));return J({role:"presentation"},h,p,{onBlur:d(p),onFocus:o(p),onMouseEnter:u(p),onMouseLeave:c(p)})},onClickAway:b}}function fa(t){return ht("MuiSnackbarContent",t)}ut("MuiSnackbarContent",["root","message","action"]);const ja=["action","className","message","role"],ba=t=>{const{classes:n}=t;return pt({root:["root"],action:["action"],message:["message"]},fa,n)},_a=Te(Ge,{name:"MuiSnackbarContent",slot:"Root",overridesResolver:(t,n)=>n.root})(({theme:t})=>{const n=t.palette.mode==="light"?.8:.98,r=It(t.palette.background.default,n);return J({},t.typography.body2,{color:t.vars?t.vars.palette.SnackbarContent.color:t.palette.getContrastText(r),backgroundColor:t.vars?t.vars.palette.SnackbarContent.bg:r,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:(t.vars||t).shape.borderRadius,flexGrow:1,[t.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}})}),va=Te("div",{name:"MuiSnackbarContent",slot:"Message",overridesResolver:(t,n)=>n.message})({padding:"8px 0"}),ya=Te("div",{name:"MuiSnackbarContent",slot:"Action",overridesResolver:(t,n)=>n.action})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),wa=m.forwardRef(function(n,r){const s=xt({props:n,name:"MuiSnackbarContent"}),{action:i,className:x,message:j,role:l="alert"}=s,a=$e(s,ja),b=s,_=ba(b);return e.jsxs(_a,J({role:l,square:!0,elevation:6,className:At(_.root,x),ownerState:b,ref:r},a,{children:[e.jsx(va,{className:_.message,ownerState:b,children:j}),i?e.jsx(ya,{className:_.action,ownerState:b,children:i}):null]}))});function Ca(t){return ht("MuiSnackbar",t)}ut("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);const Sa=["onEnter","onExited"],Da=["action","anchorOrigin","autoHideDuration","children","className","ClickAwayListenerProps","ContentProps","disableWindowBlurListener","message","onBlur","onClose","onFocus","onMouseEnter","onMouseLeave","open","resumeHideDuration","TransitionComponent","transitionDuration","TransitionProps"],ka=t=>{const{classes:n,anchorOrigin:r}=t,s={root:["root",`anchorOrigin${De(r.vertical)}${De(r.horizontal)}`]};return pt(s,Ca,n)},st=Te("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:r}=t;return[n.root,n[`anchorOrigin${De(r.anchorOrigin.vertical)}${De(r.anchorOrigin.horizontal)}`]]}})(({theme:t,ownerState:n})=>{const r={left:"50%",right:"auto",transform:"translateX(-50%)"};return J({zIndex:(t.vars||t).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center"},n.anchorOrigin.vertical==="top"?{top:8}:{bottom:8},n.anchorOrigin.horizontal==="left"&&{justifyContent:"flex-start"},n.anchorOrigin.horizontal==="right"&&{justifyContent:"flex-end"},{[t.breakpoints.up("sm")]:J({},n.anchorOrigin.vertical==="top"?{top:24}:{bottom:24},n.anchorOrigin.horizontal==="center"&&r,n.anchorOrigin.horizontal==="left"&&{left:24,right:"auto"},n.anchorOrigin.horizontal==="right"&&{right:24,left:"auto"})})}),Ta=m.forwardRef(function(n,r){const s=xt({props:n,name:"MuiSnackbar"}),i=Ot(),x={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{action:j,anchorOrigin:{vertical:l,horizontal:a}={vertical:"bottom",horizontal:"left"},autoHideDuration:b=null,children:_,className:w,ClickAwayListenerProps:d,ContentProps:o,disableWindowBlurListener:u=!1,message:c,open:C,TransitionComponent:h=Lt,transitionDuration:p=x,TransitionProps:{onEnter:g,onExited:D}={}}=s,O=$e(s.TransitionProps,Sa),oe=$e(s,Da),K=J({},s,{anchorOrigin:{vertical:l,horizontal:a},autoHideDuration:b,disableWindowBlurListener:u,TransitionComponent:h,transitionDuration:p}),N=ka(K),{getRootProps:G,onClickAway:ee}=ga(J({},K)),[te,de]=m.useState(!0),y=Pt({elementType:st,getSlotProps:G,externalForwardedProps:oe,ownerState:K,additionalProps:{ref:r},className:[N.root,w]}),A=B=>{de(!0),D&&D(B)},V=(B,je)=>{de(!1),g&&g(B,je)};return!C&&te?null:e.jsx(da,J({onClickAway:ee},d,{children:e.jsx(st,J({},y,{children:e.jsx(h,J({appear:!0,in:C,timeout:p,direction:l==="top"?"down":"up",onEnter:V,onExited:A},O,{children:_||e.jsx(wa,J({message:c,action:j},o))}))}))}))});function Ea(){const{project_id:t,id:n}=Ve(),r=fe(),s=Mt(),[i,x]=m.useState(null),[j,l]=m.useState(!0),[a,b]=m.useState(null),[_,w]=m.useState(!1),d=Ee();m.useEffect(()=>{n&&(async()=>{l(!0),b(null);try{const p=await L.post(M.stages.singlelist,{stage_id:n},{headers:{"Content-Type":"application/json"}});p.data.status&&p.data.data?x(p.data.data):x(null)}catch(p){b("An error occurred while fetching stage details."),console.error("Error fetching stage details:",p)}finally{l(!1)}})()},[n]);const o=()=>{w(!0)},u=async()=>{w(!1);try{await r(Ft(n)),s(ke.dashboard.stages.create)}catch(h){console.error("Error deleting stage:",h)}finally{d.onClose()}},c=()=>{w(!1)},C=()=>{s(ke.dashboard.stages.edit(t,n))};return j||!i&&!a?e.jsxs(me,{sx:{p:3,borderRadius:2,bgcolor:"background.default"},children:[e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(E,{spacing:.5,children:[e.jsx(Q,{variant:"text",width:"60%"}),e.jsx(Q,{variant:"text",width:"40%"})]}),e.jsx(Q,{variant:"circular",width:40,height:40})]}),e.jsx(Ce,{sx:{mb:2}}),e.jsx(E,{spacing:14,direction:{xs:"column",sm:"row"},divider:e.jsx(Ce,{orientation:"vertical",flexItem:!0}),children:[1,2,3,4].map(h=>e.jsxs(k,{children:[e.jsx(Q,{variant:"text",width:100}),e.jsx(Q,{variant:"text",width:150})]},h))})]}):a?e.jsx(f,{color:"error",children:a}):e.jsxs(e.Fragment,{children:[e.jsxs(me,{sx:{p:2,borderRadius:2,bgcolor:"background.default"},children:[e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(E,{spacing:.5,sx:{marginLeft:2,padding:1},children:[e.jsx(f,{variant:"subtitle1",children:i.stage_name}),e.jsx(f,{variant:"body1",color:"text.secondary",children:i.description})]}),e.jsx(se,{onClick:d.onOpen,color:"inherit",children:e.jsx(T,{icon:"eva:more-vertical-fill"})})]}),e.jsx(Ce,{sx:{mb:2}}),e.jsx(E,{spacing:2,direction:"row",divider:e.jsx(Ce,{orientation:"vertical",flexItem:!0}),sx:{width:"100%"},children:[{label:"Start Date",value:i.start_date?X(i.start_date):e.jsx(f,{color:"text.secondary",children:"__/__/____"})},{label:"End Date",value:i.end_date?X(i.end_date):e.jsx(f,{color:"text.secondary",children:"__/__/____"})},{label:"Actual Start Date",value:i.actual_start_date?X(i.actual_start_date):e.jsx(f,{color:"text.secondary",children:"__/__/____"})},{label:"Actual End Date",value:i.actual_end_date?X(i.actual_end_date):e.jsx(f,{color:"text.secondary",children:"__/__/____"})}].map((h,p)=>e.jsxs(k,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",width:"100%"},children:[e.jsx(f,{variant:"subtitle1",color:"text.secondary",children:h.label}),e.jsx(f,{variant:"subtitle2",children:h.value})]},p))})]}),e.jsx(Re,{open:d.open,anchorEl:d.anchorEl,onClose:d.onClose,children:e.jsxs(Ie,{children:[e.jsxs($,{onClick:o,sx:{color:"error.main"},children:[e.jsx(T,{icon:"solar:trash-bin-trash-bold",sx:{mr:1}}),"Delete Stage"]}),e.jsxs($,{onClick:C,children:[e.jsx(T,{icon:"solar:pen-bold",sx:{mr:1}}),"Edit Stage"]})]})}),e.jsxs(mt,{open:_,onClose:c,children:[e.jsx(Ct,{children:"Confirm Deletion"}),e.jsx(St,{children:e.jsx(la,{children:"Are you sure you want to delete this stage? This action cannot be undone."})}),e.jsxs(Dt,{children:[e.jsx(Z,{onClick:c,variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(Z,{onClick:u,variant:"contained",color:"error",children:"Confirm"})]})]})]})}const Ra=[{value:"all",label:"All"},{value:"TODO",label:"To Do"},{value:"IN_PROGRESS",label:"In Progress"},{value:"DONE",label:"Done"}];function Ia({handleFilterStatus:t,filters:n,taskCounts:r}){return e.jsx(gt,{value:n.state.status,onChange:t,sx:{px:2.5,boxShadow:s=>`inset 0 -2px 0 0 ${Nt(s.vars.palette.grey["500Channel"],.08)}`},children:Ra.map(s=>e.jsx(Be,{iconPosition:"end",value:s.value,icon:e.jsx(q,{variant:"soft",color:s.value==="DONE"?"success":s.value==="IN_PROGRESS"?"info":s.value==="TODO"?"error":void 0,sx:s.value!=="DONE"&&s.value!=="IN_PROGRESS"&&s.value!=="TODO"?{color:"black"}:{},children:["all","DONE","IN_PROGRESS","TODO"].includes(s.value)&&`${s.label}  ( ${r[s.value]||0} )`})},s.value))})}function xe(){const t=fe(),n=le(d=>d.tasks),r=le(d=>d.sub_tasks),{project_id:s}=ft();return{...n,...r,deleteTask:async d=>{try{const o=await L.delete(M.tasks.delete,{data:{task_id:d}}),{error_code:u}=o.data;u===0?(t(Ut(d)),console.log("Task deleted successfully")):console.error("Error deleting task:",o.data.message)}catch(o){console.error("Error deleting task:",o)}},setFilters:Wt,fetchTasks:async d=>{try{const o=await L.get(M.tasks.list,{params:{project_id:s,stage_id:d}}),{error_code:u,data:c}=o.data;u===0?t(Le(c)):(t(Le({tasks:{},sub_tasks:{}})),console.error("Error fetching tasks:",o.data.message))}catch(o){t(Le({tasks:{},sub_tasks:{}})),console.error("Error fetching tasks:",o)}},createTask:async d=>{if(d.task_name)try{const o=await L.post(M.tasks.create,{task_name:d.task_name,stage_id:d.stage_id,project_id:d.project_id,parent_id:null}),{error_code:u,data:c,message:C}=o.data;if(u!==0)throw new Error(C);t(Ht({tasks_id:c.task_id,task:c}))}catch(o){throw o instanceof Error&&o.message||typeof o=="object"&&(o==null?void 0:o.message)||o}},deleteSubTask:async(d,o)=>{try{const u=await L.delete(M.tasks.delete,{data:{task_id:d}}),{error_code:c}=u.data;c===0?(t($t({task_id:d,parent_id:o})),console.log("Task deleted successfully")):console.error("Error deleting task:",u.data.message)}catch(u){console.error("Error deleting task:",u)}},createSubTask:async d=>{if(d.task_name)try{const o=await L.post(M.tasks.create,{task_name:d.task_name,stage_id:d.stage_id,project_id:d.project_id,parent_id:d.parent_id}),{error_code:u,data:c,message:C}=o.data;if(u!==0)throw new Error(C);t(zt({tasks_id:d.parent_id,subTask:c,subtask_id:c.task_id}))}catch(o){throw o instanceof Error&&o.message||typeof o=="object"&&(o==null?void 0:o.message)||o}},deleteAllTasks:async d=>{try{const o=await L.delete(M.tasks.deleteall,{data:{task_ids:d}}),{error_code:u}=o.data;return u===0?(t(Bt(d)),console.log("Tasks deleted successfully"),!0):(console.error("Error deleting tasks:",o.data.message),!1)}catch(o){throw console.error("Error deleting tasks:",o),o}},updateSubTask:async d=>{try{const o=await L.post(M.tasks.update,d),{error_code:u}=o.data;return u===0?(t(Gt(d)),!0):!1}catch(o){throw console.error("Error updating Sub-task:",o),o}},updateTask:async d=>{try{const o=await L.post(M.tasks.update,d),{error_code:u}=o.data;return u===0?(t(Yt(d)),!0):!1}catch(o){throw console.error("Error updating tasks:",o),o}}}}function Ae({open:t,onClose:n,parent_id:r,taskname:s}){const{id:i}=Ve(),x=re(),{createTask:j,createSubTask:l}=xe(),[a,b]=m.useState(""),{currentProjectId:_}=le(u=>u.projects),w=u=>{b(u)},d=async()=>{try{x.onTrue(),await j({project_id:_,stage_id:i,task_name:a,parent_id:r}),W.success("created succesfull")}catch(u){W.error(u)}finally{x.onFalse(),n()}},o=async()=>{try{x.onTrue(),await l({project_id:_,stage_id:i,task_name:a,parent_id:r}),W.success("created succesfull")}catch(u){W.error(u)}finally{x.onFalse(),n()}};return e.jsx(qe,{open:t,onClose:n,children:e.jsxs(E,{gap:3,sx:{maxWidth:500,position:"absolute",width:400,top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:2,borderRadius:1},children:[e.jsxs(E,{sx:{width:"100%",maxWidth:500,mx:"auto"},gap:3,children:[e.jsxs(f,{variant:"h6",children:["Create ",r?"Sub Task":"Task"]}),e.jsxs(kt,{"aria-label":"breadcrumb",children:[r&&e.jsx(q,{color:"info",children:e.jsx(f,{variant:"subtitle2",children:s})}),e.jsx(q,{color:"info",children:e.jsx(f,{variant:"subtitle2",children:a})})]}),e.jsx(Y,{fullWidth:!0,placeholder:"Ex, Create a report ...",variant:"outlined",helperText:"Enter name to create a task",value:a,onChange:u=>w(u.target.value)})]}),e.jsxs(k,{sx:{mt:2,display:"flex",justifyContent:"space-between"},children:[e.jsx(Z,{variant:"outlined",onClick:n,children:"Cancel"}),e.jsx(Xe,{variant:"contained",onClick:r?o:d,loading:x.value,children:"Save"})]})]})})}const Aa=[{id:"type",Label:"",align:"center",icon:"",hide:!1,width:50},{id:"description",label:"Task name",align:"left",icon:"fluent:text-description-32-filled",hide:!1,width:300},{id:"status",label:"Status",align:"left",icon:"lets-icons:status",hide:!1,width:100},{id:"start_date",label:"Start date",align:"center",icon:"solar:calendar-date-bold",hide:!1,width:200},{id:"end_date",label:"End date",align:"center",icon:"solar:calendar-date-bold",hide:!1,width:200},{id:"actual_start_date",label:"Actual Start date",align:"center",icon:"solar:calendar-date-bold",hide:!1,width:200},{id:"actual_end_date",label:"Actual end date",align:"center",icon:"solar:calendar-date-bold",hide:!1,width:200},{id:"priority",label:"Priority",align:"left",icon:"iconoir:priority-down-solid",hide:!1,width:100},{id:"sprint_id",label:"Sprint",align:"center",icon:"fluent:arrow-sprint-20-filled",hide:!1,width:150},{id:"parent_id",label:"Parent",align:"center",icon:"gg:git-pull",hide:!1,width:230},{id:"reporter_id",label:"Creator",align:"center",icon:"heroicons:at-symbol-20-solid",hide:!1,width:200},{id:"assignee_id",label:"Assignee",align:"center",icon:"heroicons:at-symbol-20-solid",hide:!1,width:200},{width:100,hide:!1}];function Tt({order:t,orderBy:n,onRequestSort:r,rowCount:s=0,numSelected:i=0,onSelectAllRows:x}){const j=l=>a=>{r(a,l)};return e.jsx(jt,{children:e.jsxs(ce,{children:[x&&e.jsx(I,{padding:"checkbox",align:"left",children:e.jsx(Ze,{indeterminate:!!i&&i<s,checked:!!s&&i===s,onChange:l=>x(l.target.checked),inputProps:{name:"select-all-rows","aria-label":"select all rows"}})}),Aa.map(l=>e.jsx(I,{align:l.align,sortDirection:n===l.id?t:!1,sx:{width:l.width,minWidth:l.width},children:e.jsxs(Vt,{active:n===l.id,direction:n===l.id?t:"asc",onClick:j(l.id),children:[e.jsxs(E,{gap:1,direction:"row",children:[l.icon&&e.jsx(T,{icon:l.icon}),e.jsx(f,{variant:"body2",children:l.label})]}),n===l.id?e.jsx(k,{component:"span",sx:ca,children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},l.id))]})})}Tt.propTypes={onRequestSort:Me.func.isRequired,order:Me.oneOf(["asc","desc"]).isRequired,orderBy:Me.string.isRequired};const Oa=({task:t,HandleTaskChanges:n})=>{const[r,s]=m.useState(""),[i,x]=m.useState(!1),[j,l]=m.useState(t.actual_end_date||null),{employees:a}=le(c=>c.assignee),{user:b}=m.useContext(Je),_=a[t.reporter_id],w=a[t.assignee_id],d=a[b.employee_id],o=d?d.role:null,u=o&&["admin","Admin","ADMIN"].includes(o);return m.useEffect(()=>{l(t.actual_end_date||null)},[t.actual_end_date]),e.jsxs(E,{gap:2,sx:{mt:2},children:[e.jsx(E,{direction:"row",gap:12,alignItems:"center",children:e.jsxs(Y,{select:!0,label:"Status",variant:"outlined",fullWidth:!0,value:t.status||"",onChange:c=>{const C=c.target.value;if(C==="DONE"){if(!t.actual_start_date){s("Actual start date is required before setting status to Done."),x(!0);return}if(!j){s("Actual end date is required when status is set to Done."),x(!0);return}}if(C==="IN_PROGRESS"&&!t.actual_start_date){s("Actual start date is required before setting status to In Progress."),x(!0);return}s(""),n({name:"status",value:C})},children:[e.jsx($,{value:"TODO",children:"To do"}),e.jsx($,{value:"IN_PROGRESS",children:"In Progress"}),e.jsx($,{value:"DONE",children:"Done"})]})}),e.jsx(Ta,{open:i,autoHideDuration:3e3,onClose:()=>x(!1),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(qt,{onClose:()=>x(!1),severity:"error",sx:{width:"100%"},children:r})}),e.jsxs(E,{gap:1.5,children:[e.jsxs(Y,{select:!0,label:"Priority",variant:"outlined",fullWidth:!0,value:t.priority||"",disabled:!u,onChange:c=>n({name:"priority",value:c.target.value}),children:[e.jsx($,{value:"LOW",children:"Low"}),e.jsx($,{value:"MEDIUM",children:"Medium"}),e.jsx($,{value:"HIGH",children:"High"})]}),e.jsx(nt,{options:Object.values(a),getOptionLabel:c=>c!=null&&c.name?c.name:"",value:_||null,onChange:(c,C)=>{n({name:"reporter_id",value:C?C.id:null})},disabled:!u,renderInput:c=>e.jsx(Y,{...c,label:"Creator"})}),e.jsx(nt,{options:Object.values(a),name:"Assignee",value:w||null,getOptionLabel:c=>c!=null&&c.name?c.name:"",onChange:(c,C)=>{n({name:"assignee_id",value:C?C.id:null})},disabled:!u,renderInput:c=>e.jsx(Y,{...c,fullWidth:!0,label:"Assignee"})}),e.jsx(he,{label:"Start Date",value:t.start_date?H(t.start_date):null,onChange:c=>u&&n({name:"start_date",value:X(c)}),disabled:!u,renderInput:c=>e.jsx(Y,{...c,fullWidth:!0,disabled:!u})}),e.jsx(he,{label:"End Date",value:t.end_date?H(t.end_date):null,onChange:c=>{u&&(!t.start_date||H(c).isAfter(H(t.start_date)))&&n({name:"end_date",value:X(c)})},minDate:t.start_date?H(t.start_date):null,disabled:!u,renderInput:c=>e.jsx(Y,{...c,fullWidth:!0,disabled:!u})}),e.jsx(he,{label:"Actual Start Date",value:t.actual_start_date?H(t.actual_start_date):null,onChange:c=>{if(!c)return;const C=X(c);u&&n({name:"actual_start_date",value:C}),s("")},minDate:t.start_date?H(t.start_date):null,disabled:!u,renderInput:c=>e.jsx(Y,{...c,fullWidth:!0,disabled:!u})}),e.jsx(he,{label:"Actual End Date",value:j?H(j):null,onChange:c=>{if(!c){s("Actual End Date is required."),x(!0);return}if(t.actual_start_date&&H(c).isBefore(H(t.actual_start_date))){s("Actual End Date must be the same as or after the Actual Start Date."),x(!0);return}const C=X(c);l(C),u&&n({name:"actual_end_date",value:C}),s("")},minDate:t.actual_start_date?H(t.actual_start_date):t.start_date?H(t.start_date):null,disabled:!u,renderInput:c=>e.jsx(Y,{...c,fullWidth:!0,disabled:!u})}),e.jsx(Y,{placeholder:"Sprint ID",variant:"outlined",fullWidth:!0,value:t.sprint_id||"",InputProps:{readOnly:!0}})]})]})},Pa=({taskName:t,setTask:n,onAttachFile:r,toggleChildIssueView:s,issueKey:i,taskname:x,isChild:j})=>{const l=re();return e.jsxs(E,{gap:2,sx:{mt:2},children:[e.jsx(Y,{value:t,name:"task_name",label:"Task name",onChange:a=>n({name:"task_name",value:a.target.value})}),e.jsxs(E,{direction:"row",gap:2,children:[e.jsx(Z,{variant:"outlined",onClick:r,startIcon:e.jsx(T,{icon:"tdesign:attach"}),children:e.jsx(f,{variant:"body2",children:"Attach"})}),j?null:e.jsx(Z,{variant:"outlined",startIcon:e.jsx(T,{icon:"tabler:subtask"}),onClick:l.onTrue,children:e.jsx(f,{variant:"body2",children:"Add sub-task"})}),e.jsx(Ae,{open:l.value,onClose:l.onFalse,parent_id:i,taskname:x}),e.jsx(Z,{variant:"outlined",startIcon:e.jsx(T,{icon:"line-md:link"}),children:e.jsx(f,{variant:"body2",children:"Link Issue"})})]})]})},La=bt(e.jsx("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4zM18 14H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"}),"Comment"),Ma=bt(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m.06 17v-2.01H12c-1.28 0-2.56-.49-3.54-1.46-1.71-1.71-1.92-4.35-.64-6.29l1.1 1.1c-.71 1.33-.53 3.01.59 4.13.7.7 1.62 1.03 2.54 1.01v-2.14l2.83 2.83zm4.11-4.24-1.1-1.1c.71-1.33.53-3.01-.59-4.13C13.79 8.84 12.9 8.5 12 8.5h-.06v2.15L9.11 7.83 11.94 5v2.02c1.3-.02 2.61.45 3.6 1.45 1.7 1.7 1.91 4.35.63 6.29"}),"ChangeCircle"),Fa=({issueKey:t,refreshActivity:n})=>{const{user:r}=m.useContext(Je),[s,i]=m.useState("comments"),[x,j]=m.useState([]),[l,a]=m.useState([]),[b,_]=m.useState(""),[w,d]=m.useState(!1),o=(h,p)=>{i(p)},u=async()=>{try{const[h,p]=await Promise.all([L.get(M.comments.list),L.get(M.history.list)]),g=h.data.filter(O=>O.task_id===t),D=p.data.filter(O=>O.task_id===t);j(g.map(O=>({employee_name:O.employee_name,time:O.date,text:O.value}))),a(D)}catch(h){console.error("Error fetching data:",h)}},c=async()=>{if(!b.trim())return;d(!0);const h={employee_id:r.employee_id,task_id:t,value:b};try{const p=await L.post(M.comments.create,h);j(D=>[{employee_name:p.data.employee_name,time:p.data.date,text:p.data.value},...D]);const g={description:`${p.data.employee_name} added a comment : "${p.data.value}"`,timestamp:new Date().toLocaleString()};a(D=>[g,...D]),_("")}catch(p){console.error("Error adding comment:",p)}finally{d(!1)}};m.useEffect(()=>{u()},[t,n]);function C(h){return new Date(h).toLocaleString()}return e.jsxs(E,{gap:2,children:[e.jsx(f,{variant:"subtitle2",children:"Activity"}),e.jsxs(k,{sx:{border:"1px solid #e0e0e0",borderRadius:1},children:[e.jsxs(gt,{value:s,onChange:o,sx:{px:2.5,boxShadow:h=>"inset 0 -2px 0 0 rgba(0, 0, 0, 0.08)"},children:[e.jsx(Be,{iconPosition:"end",label:"Comments",value:"comments"}),e.jsx(Be,{iconPosition:"end",label:"History",value:"history"})]}),s==="comments"&&e.jsx(et,{sx:{maxHeight:230,overflowY:"auto",bgcolor:"background.paper",borderRadius:1,p:1,boxShadow:1},children:x.length===0?e.jsx(ge,{filled:!0,title:"No Comments available"}):x.map((h,p)=>e.jsx(Jt.Fragment,{children:e.jsxs(We,{alignItems:"flex-start",sx:{bgcolor:"grey.100",borderRadius:1,mb:1},children:[e.jsx(Xt,{children:e.jsx(Ye,{sx:{bgcolor:"secondary.less",color:"common.white"},children:h.employee_name.charAt(0).toUpperCase()})}),e.jsx(Fe,{primary:e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:[e.jsx(f,{variant:"subtitle1",color:"text.primary",sx:{fontWeight:"bold"},children:h.employee_name}),e.jsx(f,{component:"span",variant:"caption",color:"text.secondary",sx:{whiteSpace:"nowrap"},children:h.time})]}),secondary:e.jsx(f,{variant:"body2",color:"text.secondary",sx:{mt:1,fontSize:"0.9rem",wordWrap:"break-word"},children:h.text})})]})},p))}),s==="history"&&e.jsx(et,{sx:{maxHeight:230,overflowY:"auto",padding:1},children:l.length===0?e.jsx(ge,{filled:!0,title:"No History available"}):l.map((h,p)=>{const D=/(\w+) changed (\w+) from (.+) to (.+)/i.exec(h.description),oe=/(\w+) added a comment : (.+)/i.exec(h.description);if(D){const[K,N,G,ee,te]=D;return e.jsxs(We,{alignItems:"flex-start",sx:{paddingY:1},children:[e.jsx(at,{children:e.jsx(Ma,{color:"primary"})}),e.jsx(Fe,{primary:e.jsxs(f,{variant:"body1",sx:{fontWeight:500},children:[e.jsx("span",{style:{fontWeight:600},children:N})," ","changed"," ",e.jsx("span",{style:{color:"#1976d2",fontWeight:600},children:G.replace(/_id$/,"")})," ","from"," ",e.jsx("span",{style:{color:"#e57373"},children:ee})," ","to"," ",e.jsx("span",{style:{color:"#81c784"},children:te})]}),secondary:e.jsx(f,{component:"span",variant:"body2",color:"text.secondary",children:C(h.timestamp)})})]},p)}if(oe){const[K,N,G]=oe;return e.jsxs(We,{alignItems:"flex-start",sx:{paddingY:1},children:[e.jsx(at,{children:e.jsx(La,{color:"secondary"})}),e.jsx(Fe,{primary:e.jsxs(f,{variant:"body1",sx:{fontWeight:500},children:[e.jsx("span",{style:{fontWeight:600},children:N})," ","added a comment:"]}),secondary:e.jsxs(e.Fragment,{children:[e.jsx(f,{component:"div",variant:"body2",color:"text.secondary",sx:{marginRight:.5},children:G}),e.jsx(f,{component:"span",variant:"caption",color:"text.disabled",children:C(h.timestamp)})]})})]},p)}return null})})]}),e.jsx(Y,{value:b,onChange:h=>_(h.target.value),fullWidth:!0,placeholder:"Add a comment...",variant:"outlined",InputProps:{endAdornment:e.jsx(_t,{position:"end",children:e.jsx(Xe,{variant:"contained",loading:w,startIcon:e.jsx(T,{icon:"mingcute:add-fill"}),onClick:c,children:"Add Comment"})})}})]})},rt={TODO:{label:"To Do",color:"default"},IN_PROGRESS:{label:"In Progress",color:"info"},DONE:{label:"Done",color:"success"}},ot={HIGH:{label:"High",color:"error"},CRITICAL:{label:"Critical",color:"error"},MEDIUM:{label:"Medium",color:"warning"},LOW:{label:"Low",color:"info"}};function Na({issue:t,issueKey:n}){const{task_id:r,task_name:s,priority:i,status:x}=t,j=re(),l=Ee();return xe(),fe(),e.jsxs(e.Fragment,{children:[e.jsxs(ce,{children:[e.jsx(I,{sx:{p:0},align:"center",children:s}),e.jsx(I,{sx:{p:0},align:"center",children:e.jsx(q,{color:rt[x].color,children:rt[x].label})}),e.jsx(I,{sx:{p:0},align:"center",children:e.jsx(q,{color:ot[i].color,children:ot[i].label})}),e.jsx(I,{sx:{p:0},align:"right",children:e.jsx(se,{color:l.open?"inherit":"default",children:e.jsx(T,{icon:"eva:more-vertical-fill"})})})]}),e.jsx(Re,{open:l.open,anchorEl:l.anchorEl,onClose:l.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsx(Ie,{children:e.jsxs($,{onClick:()=>{j.onTrue(),l.onClose()},sx:{color:"error.main"},children:[e.jsx(T,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})})}),e.jsx(ua,{open:j.value,onClose:j.onFalse,title:"Delete",content:"Are you sure want to delete?",action:null})]})}const Wa=[{id:"task_name",label:"Name",align:"center"},{id:"status",label:"Status",align:"center"},{id:"priority",label:"Priority",align:"center"},{id:"",label:"",align:"right"}];function Ha({HandleTaskChanges:t,subTasksId:n=[],issueKey:r,taskname:s}){const{subTasks:i,createSubTask:x,updateSubTask:j}=xe(),l=re(),a=async(_,w)=>{try{await j({task_id:_,status:w}),t&&t({taskId:_,newStatus:w})}catch(d){console.error("Error updating task status:",d)}},b=m.useMemo(()=>{const _=n.length;let w=0,d=0,o=0;return _===0?{todo:w,inProgress:d,done:o}:(n.forEach(u=>{i[u].status==="TODO"?w+=1:i[u].status==="IN_PROGRESS"?d+=1:i[u].status==="DONE"&&(o+=1)}),{todo:w/_*100,inProgress:d/_*100,done:o/_*100})},[i,n]);return e.jsxs(E,{direction:"column",gap:2,children:[e.jsx(f,{variant:"subtitle2",children:"Sub Task"}),e.jsxs(k,{sx:{border:"1px solid #e0e0e0",borderRadius:1,p:2},children:[e.jsxs(k,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(f,{variant:"subtitle2",children:"Progress"}),e.jsxs(k,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Z,{variant:"contained",startIcon:e.jsx(T,{icon:"mingcute:add-fill"}),onClick:l.onTrue,children:e.jsx(f,{variant:"subtitle2",children:"Sub task"})}),e.jsx(Ae,{open:l.value,onClose:l.onFalse,parent_id:r,taskname:s})]})]}),e.jsxs(k,{sx:{display:"flex",width:"100%",height:10,backgroundColor:"#ddd",borderRadius:1,overflow:"hidden",my:2},children:[e.jsx(k,{sx:{width:`${b.done}%`,backgroundColor:"primary.light",borderRadius:b.done>0?"5px 0 0 5px":"5px"}}),e.jsx(k,{sx:{width:`${b.inProgress}%`,backgroundColor:"info.light"}}),e.jsx(k,{sx:{width:`${b.todo}%`,backgroundColor:"warning.light",borderRadius:b.todo>0&&b.inProgress===0?"0 5px 5px 0":"0"}})]}),e.jsx(vt,{component:Ge,sx:{mt:2},children:e.jsxs(yt,{children:[e.jsx(jt,{children:e.jsx(ce,{children:Wa.map(_=>e.jsx(I,{align:_.align,children:_.label},_.id))})}),e.jsx(wt,{children:n.length===0?e.jsx(ce,{children:e.jsx(I,{colSpan:5,align:"center",children:e.jsx(ge,{title:"No sub tasks"})})}):n.map(_=>e.jsx(Na,{issueKey:r,issue:i[_],taskname:s,onStatusChange:w=>a(_,w)},_))})]})})]})]})}const za=({description:t,setDescription:n})=>{const r=ha();return e.jsx(xa,{...r,children:e.jsxs(k,{mt:3,children:[e.jsx(f,{variant:"subtitle2",children:"Description"}),e.jsx(E,{sx:{mt:2},children:e.jsx(pa.Editor,{name:"description",value:t,onChange:s=>n({name:"description",value:s})})})]})})},Ua={pdf:{icon:"vscode-icons:file-type-pdf2",color:"#ed6767"},xlsx:{icon:"vscode-icons:file-type-excel",color:"#217346"},docx:{icon:"teenyicons:doc-solid",color:"#67caed"},jpg:{icon:"flat-color-icons:image-file"},png:{icon:"flat-color-icons:edit-image"},jpeg:{icon:"flat-color-icons:image-file"},mp4:{icon:"mdi:video"},avi:{icon:"mdi:video"}},Ue=t=>Ua[t]||null,$a=({attachedFiles:t,onDownloadFile:n,onDeleteFile:r,trimFileName:s,showAttachedFiles:i,handleDeleteFile:x,handleDownloadFile:j,fileExtension:l})=>e.jsxs(E,{spacing:2,mt:2,children:[e.jsx(f,{variant:"subtitle2",children:"Attachments"}),i.length>0||t.length>0?e.jsxs(k,{gap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(4, 1fr)"},sx:{border:"1px solid #e0e0e0",borderRadius:1,p:2},children:[i.map((a,b)=>e.jsxs(k,{component:me,sx:{width:"100%",borderRadius:.5,position:"relative",overflow:"hidden","&:hover .icon-container":{opacity:1}},children:[e.jsx(k,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:120,backgroundColor:"#f5f5f5"},children:a.file_type&&Ue(a.file_type)?e.jsx(T,{icon:Ue(a.file_type).icon,width:100,height:100,style:{color:Ue(a.file_type).color||void 0}}):null}),e.jsxs(E,{p:1,children:[e.jsx(f,{variant:"caption",children:s(a.file_name,a.file_type)}),e.jsx(f,{variant:"caption",children:"21-09-2024"})]}),e.jsxs(k,{className:"icon-container",sx:{p:1,position:"absolute",top:1,right:1,opacity:0,transition:"opacity 0.3s",display:"flex",gap:1},children:[e.jsx(k,{onClick:()=>j(a.file_name),children:e.jsx(T,{icon:"line-md:downloading-loop",style:{color:"black"}})}),e.jsx(k,{onClick:()=>x(a.file_name),children:e.jsx(T,{icon:"icon-park-solid:delete-one",style:{color:"black"}})})]})]},`show-file-${b}`)),t.map((a,b)=>e.jsxs(k,{component:me,sx:{width:"100%",borderRadius:.5,position:"relative",overflow:"hidden","&:hover .icon-container":{opacity:1}},children:[e.jsx(k,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:120,backgroundColor:"#f5f5f5"},children:a.name.endsWith(".xlsx")?e.jsx(T,{icon:"vscode-icons:file-type-excel",width:100,height:100,style:{color:"#ed6767"}}):a.name.endsWith(".docx")?e.jsx(T,{icon:"teenyicons:doc-solid",width:100,height:100,style:{color:"#67caed"}}):a.type.startsWith("image/")?e.jsx(T,{icon:"flat-color-icons:edit-image",width:100,height:100}):a.type.startsWith("video/")?e.jsx(k,{component:"video",src:URL.createObjectURL(a),controls:!0,sx:{width:"100%",height:"100%"}}):null}),e.jsxs(E,{p:1,children:[e.jsxs(f,{variant:"caption",children:[a.name," (",a.type.split("/")[1],")"]}),e.jsx(f,{variant:"caption",children:"21-09-2024"})]}),e.jsxs(k,{className:"icon-container",sx:{p:1,position:"absolute",top:1,right:1,opacity:0,transition:"opacity 0.3s",display:"flex",gap:1},children:[e.jsx(k,{onClick:()=>n(a),children:e.jsx(T,{icon:"line-md:downloading-loop",style:{color:"black"}})}),e.jsx(k,{onClick:()=>r(b),children:e.jsx(T,{icon:"icon-park-solid:delete-one",style:{color:"black"}})})]})]},`attached-file-${b}`))]}):e.jsx(ge,{filled:!0,title:"No Attachments",sx:{p:2}})]}),Ba=({handleClose:t,issueKey:n,isChild:r,taskname:s})=>{const{tasks:i,subTasks:x,updateSubTask:j,updateTask:l}=xe(),[a,b]=m.useState({}),[_,w]=m.useState([]),d=m.useRef(null),[o,u]=m.useState(!0),{id:c}=Ve(),{user:C}=m.useContext(Je),[h,p]=m.useState(!1),[g,D]=m.useState(!1),{employees:O}=le(v=>v.assignee),[oe,K]=m.useState(!1),[N,G]=m.useState(!1),[ee,te]=m.useState([]),de=le(v=>v.stages.stages),y=c?de.find(v=>v.id===c):null,A=()=>{d.current.click()},V=v=>{const{files:S}=v.target;if(S.length>0){const R=S[0];w(F=>[...F,R])}},B=(v,S)=>`${v.length>15?`${v.substring(0,15)}...`:v} (${S})`,je=v=>{w(S=>S.filter((R,F)=>F!==v))},Oe=v=>{const S=URL.createObjectURL(new Blob([v])),R=document.createElement("a");R.href=S,R.download=v.name,document.body.appendChild(R),R.click(),document.body.removeChild(R)},ae=()=>{u(!o)},[ne,be]=m.useState({}),pe=async()=>{var S,R;const v={...a,assignee_id:a.assignee_id,reporter_id:a.reporter_id,start_date:a.start_date?H(a.start_date).format("YYYY-MM-DD"):null,end_date:a.end_date?H(a.end_date).format("YYYY-MM-DD"):null,actual_start_date:a.actual_start_date?H(a.actual_start_date).format("YYYY-MM-DD"):null,actual_end_date:a.actual_end_date?H(a.actual_end_date).format("YYYY-MM-DD"):null};try{if(p(!0),r?await j(v):await l(v)){W.success("Updated successfully");try{if(ne.reporter_id&&ne.reporter_id.oldValue!==ne.reporter_id.newValue){const P={username:C.name,task_name:a.task_name,project_id:y.project_id||"No Project Name",email:((S=O[a.reporter_id])==null?void 0:S.email)||"",stage:y.stage_name,link:`/dashboard/stages/${y.project_id}/${y.id}/view`};await L.post(M.tasks.reporter,P,{headers:{"Content-Type":"application/json"}})}if(ne.assignee_id&&ne.assignee_id.oldValue!==ne.assignee_id.newValue){const P={username:C.name,task_name:a.task_name,project_id:y.project_id,email:((R=O[a.assignee_id])==null?void 0:R.email)||"",stage:y.stage_name,link:`/dashboard/stages/${y.project_id}/${y.id}/view`};await L.post(M.tasks.assignee,P,{headers:{"Content-Type":"application/json"}})}}catch(P){console.error("Failed to send notifications:",P),W.error("Failed to send notifications")}const U=P=>{var ie;return((ie=O[P])==null?void 0:ie.name)||P},z=Object.entries(ne).filter(([P,{oldValue:ie,newValue:we}])=>ie!==we).map(([P,{oldValue:ie,newValue:we}])=>({task_id:a.task_id,employee_id:C.employee_id,action:P,old_value:P==="assignee_id"||P==="reporter_id"?U(ie):ie,new_value:P==="assignee_id"||P==="reporter_id"?U(we):we}));await Promise.all(z.map(P=>L.post(M.tasks.actions,P))),be({}),D(P=>!P),_.length>0&&await Pe(),t()}}catch(F){console.error(F),W.error("Failed to update")}finally{p(!1)}},ue=({name:v,value:S})=>{b(R=>{const F=R[v],U=S;return be(z=>({...z,[v]:{oldValue:F,newValue:U}})),{...R,[v]:U}})};m.useEffect(()=>{n&&b(r?{...x[n]}:{...i[n]})},[n,i,x,r]);const Pe=async()=>{p(!0);try{const v=new FormData;v.append("project_id",(a==null?void 0:a.project_id)||null),v.append("stage_id",(a==null?void 0:a.stage_id)||null),r?(v.append("task_id",(a==null?void 0:a.parent_id)||null),v.append("subtask_id",(a==null?void 0:a.task_id)||null)):v.append("task_id",(a==null?void 0:a.task_id)||null),_.forEach(U=>{v.append("files",U)});const S=await L.post(M.attachments.attachFile,v,{headers:{"Content-Type":"multipart/form-data"}}),{message:R,status:F}=(S==null?void 0:S.data)||{};F?W.success("File attached successfully"):W.error("Failed to attach file")}catch(v){console.error("Error Details:",v),W.error("Unable to attach the file")}finally{p(!1)}},_e=m.useCallback(async()=>{try{K(!0);let v;r?v={subtask_id:(a==null?void 0:a.task_id)||null}:v={subtask_id:null,task_id:a==null?void 0:a.task_id};const S=await L.post(M.attachments.getAttachFile,v,{headers:{"Content-Type":"application/json"}}),{data:R,message:F,status:U}=(S==null?void 0:S.data)||{};if(U){const{database_attachments:z=[]}=R||{};te(z)}else console.error("Error Details")}catch(v){console.error("Error Details:",v)}finally{K(!1)}},[a==null?void 0:a.task_id,r]);m.useEffect(()=>{(a!=null&&a.task_id||a!=null&&a.parent_id)&&_e()},[a==null?void 0:a.task_id,a==null?void 0:a.parent_id,_e]);const ve=async v=>{try{G(!0);const S=ee.find(z=>z.file_name===v);let R;r?R={subtask_id:(a==null?void 0:a.task_id)||null,file_name:S.file_name}:R={subtask_id:null,task_id:a==null?void 0:a.task_id,file_name:S.file_name};const F=await L.delete(M.attachments.deleteFile,{data:R,headers:{"Content-Type":"application/json"}}),{status:U}=(F==null?void 0:F.data)||{};U?W.success("File deleted successfully"):W.error("Failed to delete the file")}catch(S){console.error("Error Details:",S),W.error("Unable to delete the file")}finally{G(!1)}},ye=async v=>{try{G(!0);const S=ee.find(z=>z.file_name===v);let R;r?R={subtask_id:(a==null?void 0:a.task_id)||null,file_name:S.file_name}:R={subtask_id:null,task_id:a==null?void 0:a.task_id,file_name:S.file_name};const U=(await L.post(M.attachments.downloadFile,R,{headers:{"Content-Type":"application/json"}})).data.download_url;if(U){const z=document.createElement("a");z.href=U,z.download=S.file_name,document.body.appendChild(z),z.click(),document.body.removeChild(z),W.success("File downloaded successfully")}else W.error("Download URL not found")}catch(S){console.error("Error Details:",S),W.error("Unable to download the file")}finally{G(!1)}};return e.jsx(k,{sx:{flexGrow:1},children:e.jsxs(Se,{container:!0,spacing:2,children:[e.jsx(Se,{xs:12,children:e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(kt,{"aria-label":"breadcrumb",children:[e.jsx(f,{sx:{color:"text.primary"},children:y.stage_name}),e.jsx(f,{sx:{color:"text.primary"},children:a.task_name})]}),e.jsx(se,{onClick:t,children:e.jsx(T,{icon:"ic:baseline-close"})})]})}),e.jsx(Se,{xs:9,children:e.jsx(tt,{sx:{height:"80vh"},children:e.jsxs(E,{gap:2,children:[e.jsx(Pa,{taskName:a.task_name,setTask:ue,onAttachFile:A,toggleChildIssueView:ae,issueKey:n,taskname:s,isChild:r}),e.jsx("input",{type:"file",ref:d,onChange:V,style:{display:"none"}}),e.jsx(za,{description:a.description,setDescription:ue}),e.jsx($a,{attachedFiles:_,onDownloadFile:Oe,onDeleteFile:je,trimFileName:B,showAttachedFiles:ee,handleDeleteFile:ve,handleDownloadFile:ye}),r?null:e.jsx(Ha,{subTasksId:a.children,HandleTaskChanges:ue,issueKey:n,taskname:s}),e.jsx(Fa,{issueKey:n,refreshActivity:g})]})})}),e.jsxs(Se,{xs:3,sx:{display:"flex",flexDirection:"column"},children:[e.jsx(tt,{sx:{height:"60vh"},children:e.jsx(Oa,{task:a,HandleTaskChanges:ue})}),e.jsx(Xe,{variant:"contained",loading:h,onClick:pe,sx:{mt:2,alignSelf:"flex-end"},children:"Save"})]})]})})},Ya=({open:t,onClose:n,issueKey:r,isChild:s,taskname:i})=>e.jsx(qe,{open:t,onClose:n,children:e.jsx(E,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"82%",bgcolor:"background.paper",boxShadow:24,p:3,borderRadius:2,minHeight:"85vh",maxHeight:"100vh"},children:e.jsx(Ba,{handleClose:n,issueKey:r,isChild:s,taskname:i})})}),it={TODO:{label:"To Do",color:"default"},IN_PROGRESS:{label:"In Progress",color:"info"},DONE:{label:"Done",color:"success"}},lt={HIGH:{label:"High",color:"error"},CRITICAL:{label:"Critical",color:"error"},MEDIUM:{label:"Medium",color:"warning"},LOW:{label:"Low",color:"info"}};function Et({task:t,isChild:n=!1,selected:r,onSelectRow:s,loading:i}){const{employees:x}=le(O=>O.assignee),{subTasks:j,deleteTask:l,deleteSubTask:a}=xe(),b=Ee(),_=fe(),w=re(),d=re(),o=re(),[u,c]=m.useState(!1),C=x[t.reporter_id],h=x[t.assignee_id];if(i)return e.jsx(ce,{children:e.jsx(I,{colSpan:12,children:e.jsxs(E,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(Q,{variant:"circular",width:32,height:32}),e.jsx(Q,{variant:"text",width:"20%"}),e.jsx(Q,{variant:"text",width:"40%"}),e.jsx(Q,{variant:"text",width:"15%"}),e.jsx(Q,{variant:"rectangular",height:20,width:"10%"}),e.jsx(Q,{variant:"rectangular",height:20,width:"10%"})]})})});if(!t)return null;const p=()=>{c(!1),_(n?a(t.task_id,t.parent_id):l(t.task_id)),b.onClose()},g=()=>{c(!1)},D=()=>{b.onClose(),c(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(ce,{hover:!0,selected:r,tabIndex:-1,children:[e.jsx(I,{scope:"row",size:"small",align:"center",padding:"checkbox",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)"},children:!n&&e.jsx(Ze,{checked:r,onClick:s})}),e.jsx(I,{alignItems:"center",size:"small",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)"},children:!n&&e.jsxs(E,{gap:.5,direction:"row",sx:{alignItems:"center"},children:[e.jsx(se,{className:"icon-button",variant:"contained",onClick:d.onTrue,children:e.jsx(T,{icon:"mingcute:add-circle-line"})}),((t==null?void 0:t.children)||[]).length>0&&e.jsx(se,{onClick:o.onToggle,children:e.jsx(T,{icon:o.value?"mingcute:down-line":"mingcute:right-line"})}),e.jsx(Ae,{open:d.value,onClose:d.onFalse,parent_id:t.task_id,taskname:t.task_name})]})}),e.jsx(I,{align:"left",size:"small",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)",minWidth:300,cursor:"pointer","&:hover":{textDecoration:"underline",bgcolor:"rgba(0, 0, 0, 0.05)"}},onClick:w.onTrue,children:e.jsx(f,{variant:"body2",children:t.task_name})}),e.jsx(I,{align:"center",size:"small",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)"},children:e.jsx(q,{color:it[t.status].color,children:it[t.status].label})}),e.jsx(I,{align:"center",size:"small",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)",minWidth:200},children:e.jsx(f,{variant:"overline",children:X(t.start_date)})}),e.jsx(I,{align:"center",size:"small",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)",minWidth:200},children:e.jsx(f,{variant:"overline",children:X(t.end_date)})}),e.jsx(I,{align:"center",size:"small",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)",minWidth:200},children:e.jsx(f,{variant:"overline",children:X(t.actual_start_date)||e.jsx(q,{children:"Un-Defined"})})}),e.jsx(I,{align:"center",size:"small",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)",minWidth:200},children:e.jsx(f,{variant:"overline",children:X(t.actual_end_date)||e.jsx(q,{children:"Un-Defined"})})}),e.jsx(I,{align:"center",size:"small",borderRight:"1px dashed grey",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)"},children:e.jsx(q,{color:lt[t.priority].color,children:lt[t.priority].label})}),e.jsx(I,{align:"center",size:"small",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)"},children:e.jsx(f,{variant:t.sprint_id&&"overline",sx:{textDecoration:"underline",cursor:"pointer"},children:t.sprint_id||e.jsx(q,{children:"Un-Defined"})})}),e.jsx(I,{align:"center",size:"small",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)"},children:e.jsx(f,{variant:"overline",sx:{textDecoration:"underline"},children:t.parent_id})}),e.jsx(I,{align:"center",size:"small",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)",minWidth:200,verticalAlign:"middle"},children:t.reporter_id?e.jsxs(E,{component:"li",direction:"row",spacing:2,alignItems:"center",sx:{width:"100%",display:"flex",alignItems:"center"},children:[e.jsx(Ye,{alt:C.name||"Reporter Avatar",src:C.avatar,sx:{width:32,height:32,borderRadius:"50%"}}),e.jsxs(E,{direction:"column",sx:{width:"100%",justifyContent:"center"},children:[e.jsx(f,{variant:"body2",fontWeight:"bold",color:"text.primary",children:C.name}),e.jsx(f,{variant:"caption",color:"text.secondary",children:C.email})]})]}):e.jsx(q,{children:"Un-Assigned"})}),e.jsx(I,{align:"center",size:"small",sx:{borderRight:"1px dashed rgba(0, 0, 0, 0.1)",minWidth:200,verticalAlign:"middle"},children:t.assignee_id?e.jsxs(E,{component:"li",direction:"row",spacing:2,alignItems:"center",sx:{width:"100%",display:"flex",alignItems:"center"},children:[e.jsx(Ye,{alt:h.name,src:h.avatar,sx:{width:32,height:32,borderRadius:"50%"}}),e.jsxs(E,{direction:"column",sx:{width:"100%",justifyContent:"center"},children:[e.jsx(f,{variant:"body2",fontWeight:"bold",color:"text.primary",children:h.name}),e.jsx(f,{variant:"caption",color:"text.secondary",children:h.email})]})]}):e.jsx(q,{children:"Un-Assigned"})}),e.jsx(I,{align:"center",size:"small",children:e.jsx(se,{color:b.open?"inherit":"default",onClick:b.onOpen,children:e.jsx(T,{icon:"eva:more-vertical-fill"})})})]},t.task_id),e.jsx(Re,{open:b.open,anchorEl:b.anchorEl,onClose:b.onClose,children:e.jsxs(Ie,{children:[e.jsxs($,{onClick:D,sx:{color:"error.main"},children:[e.jsx(T,{icon:"solar:trash-bin-trash-bold"}),"Delete"]}),e.jsxs($,{onClick:()=>{b.onClose(),w.onTrue()},children:[e.jsx(T,{icon:"solar:pen-bold"}),"Edit"]})]})}),e.jsxs(mt,{open:u,onClose:g,"aria-labelledby":"delete-confirmation-dialog",children:[e.jsx(Ct,{id:"delete-confirmation-dialog",children:"Confirm Deletion"}),e.jsx(St,{children:e.jsx("p",{children:"Are you sure you want to delete this task?"})}),e.jsxs(Dt,{children:[e.jsx(Z,{onClick:g,color:"primary",children:"Cancel"}),e.jsx(Z,{onClick:p,color:"error",variant:"contained",children:"Delete"})]})]}),o.value&&((t==null?void 0:t.children)||[]).map(O=>e.jsx(Et,{task:j[O],isChild:!0})),e.jsx(Ya,{open:w.value,onClose:w.onFalse,issueKey:t.task_id,isChild:!!t.parent_id,taskname:t.task_name})]})}function Ga({filters:t,onResetPage:n,dateError:r}){const s=Ee(),i=m.useCallback(l=>{n(),t.setState({name:l.target.value})},[t,n]),x=m.useCallback(l=>{n(),t.setState({startDate:l})},[t,n]),j=m.useCallback(l=>{n(),t.setState({endDate:l})},[t,n]);return e.jsxs(e.Fragment,{children:[e.jsxs(E,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:[e.jsx(he,{label:"Start date",value:t.state.startDate,onChange:x,slotProps:{textField:{fullWidth:!0}},sx:{maxWidth:{md:200}}}),e.jsx(he,{label:"End date",value:t.state.endDate,onChange:j,slotProps:{textField:{fullWidth:!0,error:r,helperText:r?"End date must be later than start date":null}},sx:{maxWidth:{md:200},[`& .${Zt.root}`]:{position:{md:"absolute"},bottom:{md:-40}}}}),e.jsxs(E,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[e.jsx(Y,{fullWidth:!0,value:t.state.name,onChange:i,placeholder:"Search task , priority , status...",InputProps:{startAdornment:e.jsx(_t,{position:"start",children:e.jsx(T,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsx(se,{onClick:s.onOpen,children:e.jsx(T,{icon:"eva:more-vertical-fill"})})]})]}),e.jsx(Re,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Ie,{children:[e.jsxs($,{onClick:()=>{s.onClose()},children:[e.jsx(T,{icon:"solar:printer-minimalistic-bold"}),"Print"]}),e.jsxs($,{onClick:()=>{s.onClose()},children:[e.jsx(T,{icon:"solar:import-bold"}),"Import"]}),e.jsxs($,{onClick:()=>{s.onClose()},children:[e.jsx(T,{icon:"solar:export-bold"}),"Export"]})]})})]})}function Va({dense:t,action:n,rowCount:r,numSelected:s,onSelectAllRows:i,sx:x,...j}){return s?e.jsxs(E,{direction:"row",alignItems:"center",sx:{pl:1,pr:2,top:0,left:0,width:1,zIndex:9,height:55,position:"absolute",bgcolor:"primary.lighter",...t&&{height:38},...x},...j,children:[e.jsx(Ze,{indeterminate:!!s&&s<r,checked:!!r&&s===r,onChange:l=>i(l.target.checked)}),e.jsxs(f,{variant:"subtitle2",sx:{ml:2,flexGrow:1,color:"primary.main",...t&&{ml:3}},children:[s," selected"]}),n&&n]}):null}function qa({filters:t,totalResults:n,onResetPage:r,sx:s}){const i=m.useCallback(()=>{r(),t.setState({name:""})},[t,r]),x=m.useCallback(()=>{r(),t.setState({status:"all"})},[t,r]),j=m.useCallback(()=>{r(),t.setState({startDate:null,endDate:null})},[t,r]),l=m.useCallback(()=>{r(),t.onResetState()},[t,r]);return e.jsxs(ma,{totalResults:n,onReset:l,sx:s,children:[e.jsx(He,{label:"Status:",isShow:t.state.status!=="all",children:e.jsx(Ne,{...ze,label:t.state.status,onDelete:x,sx:{textTransform:"capitalize"}})}),e.jsx(He,{label:"Date:",isShow:!!(t.state.startDate&&t.state.endDate),children:e.jsx(Ne,{...ze,label:Qt(t.state.startDate,t.state.endDate),onDelete:j})}),e.jsx(He,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(Ne,{...ze,label:t.state.name,onDelete:i})})]})}function Ja(){const{tasks:t,fetchTasks:n,setFilters:r,deleteAllTasks:s,subTasks:i}=xe(),x=re();fe();const{id:j}=ft(),[l,a]=m.useState(!0),[b,_]=m.useState(!1),[w,d]=m.useState("asc"),[o,u]=m.useState("key"),c=()=>{_(!0)},C=()=>{_(!1)},h=()=>{G(),C()},p=(y,A)=>{if(A==="start_date"||A==="end_date"||A==="actual_end_date"||A==="actual_start_date")return;d(o===A&&w==="asc"?"desc":"asc"),u(A)},g=sa({defaultOrderBy:"key"}),D=Kt({name:"",status:"all",startDate:null,endDate:null}),O=m.useCallback((y,A)=>{g.onResetPage(),D.setState({status:A})},[D,g]),oe=m.useMemo(()=>D.state.startDate&&D.state.endDate?new Date(D.state.startDate).getTime()>new Date(D.state.endDate).getTime():!1,[D.state.startDate,D.state.endDate]),K=m.useMemo(()=>!!D.state.name||D.state.status!=="all"||!!D.state.startDate&&!!D.state.endDate,[D.state]),N=m.useMemo(()=>{const{status:y,startDate:A,endDate:V,name:B}=D.state;return{...t,...i},Object.entries(t).filter(([Oe,ae])=>{var ve,ye,v,S,R;const ne=new Date(ae.start_date).getTime(),be=new Date(ae.end_date).getTime(),pe=i==null?void 0:i[Oe],ue=!B||ae.task_name.toLowerCase().includes(B.toLowerCase())||((ve=pe==null?void 0:pe.task_name)==null?void 0:ve.toLowerCase().includes(B.toLowerCase()))||((ye=ae.status)==null?void 0:ye.toLowerCase().includes(B.toLowerCase()))||((v=ae.priority)==null?void 0:v.toLowerCase().includes(B.toLowerCase()))||((S=ae.reporter_name)==null?void 0:S.toLowerCase().includes(B.toLowerCase()))||((R=ae.assignee_name)==null?void 0:R.toLowerCase().includes(B.toLowerCase())),Pe=y==="all"||y===ae.status,_e=(!A||ne>=new Date(A).getTime())&&(!V||be<=new Date(V).getTime());return ue&&Pe&&_e}).sort(Xa(w,o))},[t,D,i,w,o]);m.useEffect(()=>{a(!0),n(j).finally(()=>a(!1))},[j]);const G=()=>{s([...g.selected]).then(y=>{y&&g.setSelected([])}).catch(y=>{console.error("Error occurred while deleting tasks:",y)})},ee=y=>(Array.isArray(y)?y:Object.values(y||{})).flatMap(V=>V.subTasks?[V,...ee(V.subTasks)]:[V]),te=ee([...Object.values(t||{}),...Object.values(i||{})]),de={all:te.length,TODO:te.filter(y=>(y==null?void 0:y.status)==="TODO").length,IN_PROGRESS:te.filter(y=>(y==null?void 0:y.status)==="IN_PROGRESS").length,DONE:te.filter(y=>(y==null?void 0:y.status)==="DONE").length};return e.jsx(ea,{children:e.jsxs(E,{gap:3,children:[e.jsx(na,{heading:"Stages",links:[{name:"Dashboard",href:ke.dashboard.root},{name:"Stages",href:ke.dashboard.stages.create},{name:"Tasks"}],action:e.jsx(Z,{variant:"contained",startIcon:e.jsx(T,{icon:"mingcute:add-fill"}),onClick:x.onTrue,children:"New Task"})}),e.jsx(Ae,{open:x.value,onClose:x.onFalse}),e.jsx(Ea,{}),e.jsxs(me,{children:[e.jsx(Ia,{handleFilterStatus:O,filters:D,taskCounts:de}),e.jsx(Ga,{filters:D,onResetPage:g.onResetPage,dateError:oe}),K&&e.jsx(qa,{filters:D,totalResults:N.length,onResetPage:g.onResetPage,sx:{p:2.5,pt:0}}),e.jsx(vt,{component:Ge,sx:{borderRadius:0},children:e.jsxs(k,{sx:{position:"relative"},children:[e.jsx(Va,{dense:g.dense,numSelected:g.selected.length,rowCount:N.length,onSelectAllRows:y=>g.onSelectAllRows(y,N.map(([A])=>A)),action:e.jsxs(e.Fragment,{children:[e.jsx(ta,{title:"Delete",children:e.jsx(se,{onClick:c,children:e.jsx(T,{icon:"solar:trash-bin-trash-bold"})})}),e.jsx(qe,{open:b,onClose:C,"aria-labelledby":"delete-confirmation-title","aria-describedby":"delete-confirmation-description",children:e.jsxs(k,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,p:4,borderRadius:2},children:[e.jsx(f,{id:"delete-confirmation-title",variant:"h6",gutterBottom:!0,children:"Confirm Deletion"}),e.jsx(f,{id:"delete-confirmation-description",variant:"body1",gutterBottom:!0,children:"Are you sure you want to delete the selected items?"}),e.jsxs(k,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(Z,{variant:"outlined",onClick:C,children:"Cancel"}),e.jsx(Z,{variant:"contained",color:"error",onClick:h,children:"Delete"})]})]})})]})}),e.jsxs(yt,{children:[e.jsx(Tt,{order:w,orderBy:o,onRequestSort:p,onSelectAllRows:y=>g.onSelectAllRows(y,N.map(([A])=>A)),rowCount:N.length,numSelected:g.selected.length}),e.jsx(wt,{children:N.length>0?N.slice(g.page*g.rowsPerPage,g.page*g.rowsPerPage+g.rowsPerPage).map(([y,A])=>e.jsx(Et,{task:A,selected:g.selected.includes(y),onSelectRow:()=>g.onSelectRow(y),loading:l},y)):e.jsxs(ce,{children:[e.jsx(ia,{height:g.dense?56:76,emptyRows:ra(g.page,g.rowsPerPage,N.length)}),e.jsx(I,{colSpan:14,children:e.jsx(ge,{filled:!0,sx:{py:1}})})]})})]})]})}),e.jsx(oa,{page:g.page,dense:g.dense,count:N.length,rowsPerPage:g.rowsPerPage,onPageChange:g.onChangePage,onChangeDense:g.onChangeDense,onRowsPerPageChange:g.onChangeRowsPerPage})]})]})})}function ct(t,n,r){var x,j,l,a;const s=((j=(x=t[1])==null?void 0:x.task_name)==null?void 0:j.toLowerCase())??"",i=((a=(l=n[1])==null?void 0:l.task_name)==null?void 0:a.toLowerCase())??"";return r==="task_name"?s.localeCompare(i):i<s?-1:i>s?1:0}function Xa(t,n){return t==="desc"?(r,s)=>ct(r,s,n):(r,s)=>-ct(r,s,n)}const dt={title:"Minimals UI: The starting point for your next project",description:"The starting point for your next project with Minimal UI Kit, built on the newest version of Material-UI ©, ready to be customized to your style"};function yn(){return e.jsxs(e.Fragment,{children:[e.jsxs(aa,{children:[e.jsxs("title",{children:[" ",dt.title]}),e.jsx("meta",{name:"description",content:dt.description})]}),e.jsx(Ja,{})]})}export{yn as default};
